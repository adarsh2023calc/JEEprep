<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Online Judge - LeetCode Style</title>

    <!-- Monaco -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f5f7fa;
        }
        .container {
            display: grid;
            grid-template-columns: 20% 35% 45%;
            height: 100vh;
            overflow: hidden;
        }
        .panel {
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #ddd;
        }
        #editor {
            height: 60vh;
            width:auto;
            border: 1px solid #ccc;
        }
        pre {
            background: #000;
            color: #0f0;
            padding: 15px;
            height: 200px;
            overflow: auto;
        }
        button {
            background: #0d6efd;
            border: none;
            padding: 10px 18px;
            color: white;
            font-size: 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover { background: #0a58ca; }
        ul { padding-left: 20px; }


        label[for="theme"] {
    font-size: 14px;
    font-weight: 600;
    color: #444;
    margin-right: 8px;
}

#theme {
    padding: 6px 12px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #ccc;
    background-color: #fff;
    color: #333;
    cursor: pointer;
    outline: none;
}

#theme:hover {
    border-color: #007bff;
}

        #theme:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
        }

        /* Dark page support */
        body.dark label[for="theme"] {
            color: #ccc;
        }

        body.dark #theme {
            background-color: #1e1e1e;
            color: #eee;
            border-color: #444;
        }

    </style>
</head>
<body>

<div class="container">

    
    <!-- PROBLEM LIST PANEL -->
    <div class="panel">
        
        <h3>Problems</h3>
        <ul id="problem-list"></ul>
    </div>

    <!-- PROBLEM DESCRIPTION -->
    <div class="panel">
        
        <h2 id="problem-title"></h2>
        <p id="problem-description"></p>

        <h3>Topics</h3>
        <ul id="problem-topics"></ul>

        <h3>Example</h3>
        <pre id="problem-example"></pre>

        <h3>Testcases</h3>
        <ul id="problem-testcases"></ul>
    </div>

    <!-- EDITOR + TESTCASES -->
    <div class="panel">
        <label for="theme"">Theme</label>
        <select id="theme">
            <option value="vs">Light</option>
            <option value="vs-dark">Dark</option>
            <option value="hc-black">High Contrast</option>

            <option value="dracula">Dracula</option>
            <option value="monokai">Monokai</option>
            <option value="solarized-dark">Solarized Dark</option>
            <option value="one-dark">One Dark</option>
            <option value="github-dark">GitHub Dark</option>
        </select>
        <h3>Code Editor</h3>
        <div id="editor"></div>

        <button onclick="run()">Run</button>

        <h3>Testcases</h3>

        <label>Input 1:</label>
        <textarea id="testcase1" style="width:100%;height:60px;"></textarea>

        <label>Input 2:</label>
        <textarea id="testcase2" style="width:100%;height:60px;"></textarea>

        <h3>Output</h3>
        <pre id="output"></pre>
    </div>

</div>

<script>
/* -----------------------
   Problem JSON (Your Data)
------------------------ */
let problemData = JSON.parse(localStorage.getItem("inner")).output;

let CurrentProblem =0;

let CodingAnswers={}



/* -----------------------
   Inject Problem List
------------------------ */
function loadProblemList() {
    const list = document.getElementById("problem-list");
    list.innerHTML = "";

    problemData.forEach((p, index) => {
        const li = document.createElement("li");
        li.style.cursor = "pointer";
        li.style.marginBottom = "8px";
        li.innerHTML = `<b>${p.title}</b> (${p.difficulty})`;
        li.onclick = () => loadProblem(index);
        
        list.appendChild(li);
    });
}



/* -----------------------
   Display Selected Problem
------------------------ */

function loadProblem(index) {
    if(window.editor){
        CodingAnswers[CurrentProblem]=window.editor.getValue();
    }
    const p = problemData[index];
    CurrentProblem =index;
    
    document.getElementById("problem-title").innerText = p.title;
    document.getElementById("problem-description").innerHTML = p.description;
    
    const model = window.editor;

    if (index in CodingAnswers){
        model.setValue(CodingAnswers[index]);
    }
    

    else{
        CodingAnswers[index]= p.boiler_plate_code;
        model.setValue(p.boiler_plate_code);
    }


    
    document.getElementById("problem-topics").innerHTML =
        p.topics.map(t => `<li>${t}</li>`).join("");

    document.getElementById("problem-example").innerText =
        p.testcases[0].input + "\nOutput: " + p.testcases[0].output;

    document.getElementById("problem-testcases").innerHTML =
        p.testcases.map(tc =>
            `<li><b>Input:</b> ${tc.input}<br><b>Output:</b> ${tc.output}</li>`
        ).join("");
    
    

    // Auto-fill testcases
    if (p.testcases[0]) document.getElementById("testcase1").value = convertTest(p.testcases[0]);
    if (p.testcases[1]) document.getElementById("testcase2").value = convertTest(p.testcases[1]);
}




/* Convert "nums = [2,7], target = 9" â†’ {"nums":[2,7],"target":9} */

/* TO-DO:  Convert nested arrays*/
function convertTest(tc) {
    const obj = {};

    /* Do not change the pair.split(", ") Testcases will become wrong. Most of us by basic
    inuition might use "," but that is insufficient to do so  
    */
   
    tc.input.split(", ").forEach(pair => {
        let [k, v] = pair.split("=").map(s => s.trim());
        try { obj[k] = JSON.parse(v); }
        catch { obj[k] = v; }
    });
    return JSON.stringify(obj);
}

/* -----------------------
   Monaco Editor Setup
------------------------ */
require.config({ paths: { "vs": "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs" }});

require(["vs/editor/editor.main"], function () {
    window.editor = monaco.editor.create(document.getElementById('editor'), {
        value: `
import sys
import json
class Solution:
    def twoSum(self, nums, target):

if __name__ == "__main__":
    raw = [json.loads(arg) for arg in sys.argv[1:]]
    sol = Solution()

    for tc in raw:
        output = sol.twoSum(tc["nums"], tc["target"])
        print(output)`,
        language: "python",
        theme: "vs-dark"
    });
    loadProblem(0);

    monaco.editor.defineTheme("dracula", {
    base: "vs-dark",
    inherit: true,
    rules: [
        { token: "comment", foreground: "6272a4" },
        { token: "string", foreground: "f1fa8c" },
        { token: "keyword", foreground: "ff79c6" }
    ],
    colors: {
        "editor.background": "#282a36"
    }
});

monaco.editor.defineTheme("monokai", {
    base: "vs-dark",
    inherit: true,
    rules: [
        { token: "comment", foreground: "75715E" },
        { token: "string", foreground: "E6DB74" },
        { token: "keyword", foreground: "F92672" }
    ],
    colors: {
        "editor.background": "#272822"
    }
});
});



document.getElementById("theme").addEventListener("change", (e) => {
    
    monaco.editor.setTheme(e.target.value);
})
/* -----------------------
   Run Button
------------------------ */
async function run() {
    const code = editor.getValue();
    const t1 = document.getElementById("testcase1").value;
    const t2 = document.getElementById("testcase2").value;

    const response = await fetch("/api/run/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            code: code,
            language: "python",
            testcases: [t1, t2]
        })
    });

    const data = await response.json();

    document.getElementById("output").innerText = data.output;
}

/* -----------------------
   On Page Load
------------------------ */
window.onload = function () {
    loadProblemList();
    
};
</script>

</body>
</html>
